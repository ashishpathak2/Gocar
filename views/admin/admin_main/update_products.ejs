<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product</title>
</head>
<body>

    <%- include("../admin_partial/admin_navbar.ejs") -%>


    <div class="col-md-10 mt-4 scrollable-large">

      <div class="container">

        <form action="/admin/updateproduct" method="post" enctype="multipart/form-data">

          <!-- Row for Car Company -->
          <div class="row mb-4">
            <label for="carCompany" class="col-md-3 col-form-label">Car Company</label>
            <div class="col-md-9">
              <input type="text" name="carCompany" value="<%=updateCar.carCompany%>" placeholder="Car company" class="form-control">
            </div>
          </div>
        
          <!-- Row for Car Name -->
          <div class="row mb-4">
            <label for="carName" class="col-md-3 col-form-label">Car Name</label>
            <div class="col-md-9">
              <input type="text" name="carName"  value="<%=updateCar.carName%>" placeholder="Car name" class="form-control">
            </div>
          </div>
        
          <!-- Row for Car Price -->
          <div class="row mb-4">
            <label for="carPrice" class="col-md-3 col-form-label">Car Price</label>
            <div class="col-md-9">
              <input type="text" name="carPrice" value="<%=updateCar.carPrice%>" placeholder="Car price" class="form-control">
            </div>
          </div>
        
          <!-- Row for Car Market Price -->
          <div class="row mb-4">
            <label for="carMarketPrice" class="col-md-3 col-form-label">Car Market Price</label>
            <div class="col-md-9">
              <input type="text" name="carMarketPrice" value="<%=updateCar.carMarketPrice%>" placeholder="Car market price" class="form-control">
            </div>
          </div>
        
          <!-- Row for Car City -->
          <div class="row mb-4">
            <label for="carCity" class="col-md-3 col-form-label">Car City</label>
            <div class="col-md-9">
              <select name="carCity" id="carCity" class="form-select">
                <option value="<%=updateCar.city%>"><%=updateCar.city%></option>
                <!-- Add cities options here -->
              </select>
            </div>
          </div>
        
          <!-- Car Parked At Section -->
          <div class="row mb-4">
            <label class="col-md-3 col-form-label">Car Parked At Detail:</label>
            <div class="col-md-9">
              <div class="mb-2 d-flex align-items-center justify-content-between">
                <label for="building">Building:</label>
                <input type="text" name="building" class="form-control w-75" value="<%=updateCar.carParkedAt.building%>" placeholder="Building/Appartment/Flat/Floor" required>
              </div>
        
              <div class="mb-2 d-flex align-items-center justify-content-between ">
                <label for="address">Address:</label>
                <input type="text" name="address" class="form-control w-75 " value="<%=updateCar.carParkedAt.address%>" placeholder="Full address" required>
              </div>
        
              <div class="mb-2 d-flex align-items-center justify-content-between ">
                <label for="googleMapLocationUrl">Google Map Location URL:</label>
                <input type="text" name="googleMapLocationUrl" class=" w-75 form-control" value="<%=updateCar.carParkedAt.googleMapLocationUrl%>" placeholder="Enter url" required>
              </div>
        
              <div class="mb-2 d-flex align-items-center justify-content-between ">
                <label for="locationManagerPhone">Location Manager Phone:</label>
                <input type="text" name="locationManagerPhone" class=" w-75 form-control" value="<%=updateCar.carParkedAt.locationManagerPhone%>" placeholder="Mobile number" required>
              </div>
            </div>
          </div>
        
          <!-- Row for Total KM Driven -->
          <div class="row mb-4">
            <label for="totaldriven" class="col-md-3 col-form-label">Total KM Driven:</label>
            <div class="col-md-9">
              <input type="number" name="totaldriven" value="<%=updateCar.carDftDetail[0]%>" placeholder="Enter total driven" class="form-control">
            </div>
          </div>
        
          <!-- Row for Owner Count -->
          <div class="row mb-4">
            <label for="ownercount" class="col-md-3 col-form-label">Owner Count:</label>
            <div class="col-md-9">
              <select name="ownercount" id="ownercount" class="form-select">
                <option value="<%=updateCar.carDftDetail[1]%>"><%=updateCar.carDftDetail[1]%></option>
                <option value="1ST OWNER">1ST OWNER</option>
                <option value="2ND OWNER">2ND OWNER</option>
                <option value="3RD OWNER">3RD OWNER</option>
                <option value="4TH OWNER">4TH OWNER</option>
              </select>
            </div>
          </div>
        
          <!-- Row for Transmission -->
          <div class="row mb-4">
            <label for="transmission" class="col-md-3 col-form-label">Transmission:</label>
            <div class="col-md-9">
              <select name="transmission" id="transmission" class="form-select">
                <option value="<%=updateCar.carDftDetail[3]%>"><%=updateCar.carDftDetail[3]%></option>
                <option value="AUTOMATIC">AUTOMATIC</option>
                <option value="MANUAL">MANUAL</option>
              </select>
            </div>
          </div>
        
          <!-- Row for Fuel Type -->
          <div class="row mb-4">
            <label for="fueltype" class="col-md-3 col-form-label">Fuel Type:</label>
            <div class="col-md-9">
              <select name="fueltype" id="fueltype" class="form-select">
                <option value="<%=updateCar.carDftDetail[2]%>"><%=updateCar.carDftDetail[2]%></option>
                <option value="PETROL">PETROL</option>
                <option value="DIESEL">DIESEL</option>
                <option value="ELECTRIC">ELECTRIC</option>
                <option value="HYBRID">HYBRID</option>
              </select>
            </div>
          </div>
        
          <!-- Row for Main Image -->
          <div class="row mb-4">
            <label for="mainimage" class="col-md-3 col-form-label">Add Main Image:</label>
            <div class="col-md-9">
              <input type="file"  name="mainImage" class="form-control">
            </div>
          </div>
        
          <!-- Row for Slider Images -->
          <div class="row mb-4">
            <label for="sliderimage" class="col-md-3 col-form-label">Add Slider Images:</label>
            <div class="col-md-9">
              <input type="file"  name="slideImages" class="form-control" multiple>
            </div>
          </div>
        
          <!-- Row for Service Report (PDF) -->
          <div class="row mb-4">
            <label for="serviceReport" class="col-md-3 col-form-label">Upload Service Report (PDF):</label>
            <div class="col-md-9">
              <input type="file" name="serviceReport" accept="application/pdf" class="form-control">
            </div>
          </div>
        
          <!-- Imperfect parts section -->
          <div class="row mb-4">
            <label for="imperfectParts" class="col-md-3 col-form-label">Add Imperfect Parts:</label>  
            <div class="col-md-9">
                <div class="d-flex gap-3 flex-wrap">
                    <% updateCar.carInspectionReport.imperfections.forEach(part => { %> 
                      <div class="imperfectionsId d-flex border flex-column justify-content-center align-items-center text-center rounded-3 position-relative" 
                      style="width: 8rem; height: 8rem; overflow: hidden; position: relative;">
                      
                     <!-- Image and text content -->
                     <img class="h-50" style="object-fit:cover;" 
                          src="<% if (part.partImage) { %>data:image/jpeg;base64,<%= part.partImage.toString('base64') %><% } %>" alt="">
                     <h6 class="m-0"><%= part.partName %></h6>
                      
                     <!-- Hidden delete button -->
                     <button type="button" onclick="handleImperfectionsImageDelete(event)"  value="<%= part._id %>"  class="delete-btn btn btn-danger">Delete</button>
                 </div>
                 
                    <% }) %>
                </div>
                
                
              <div id="imperfect-parts-container" class="d-flex flex-column gap-2 mt-3">
                <div class="d-flex gap-3 align-items-center">
                    <input type="file" name="imperfectPartImages[]" class="form-control w-50">
                    <input type="text" name="imperfectPartNames[]" placeholder="Enter Part Name" class="form-control w-50">
                  </div>
              </div>
              <button type="button" id="addImperfectPartBtn" class="btn btn-dark mt-2 py-2 d-flex align-items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                  <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                </svg>
                <h6 class="m-0">Add Another Imperfect Part</h6>
              </button>
            </div>
            <input type="hidden" name="arrayOfImperfectionIds" id="arrayOfImperfectionIds">
          </div>
        
          <!-- Repainted parts section -->
          <div class="row mb-4">
            <label for="repairedParts" class="col-md-3 col-form-label">Add Repaired Parts:</label>  
            <div class="col-md-9">
              <div class="d-flex gap-3 flex-wrap">
                <% updateCar.carInspectionReport.repairedParts.forEach(part => { %> 
                  <div class="RepairedId d-flex border flex-column justify-content-center align-items-center text-center rounded-3 position-relative" 
                  style="width: 8rem; height: 8rem; overflow: hidden; position: relative;">
                  
                 <!-- Image and text content -->
                 <img class="h-50" style="object-fit:cover;" 
                      src="<% if (part.partImage) { %>data:image/jpeg;base64,<%= part.partImage.toString('base64') %><% } %>" alt="">
                 <h6 class="m-0"><%= part.partName %></h6>
             
                 <!-- Hidden delete button -->
                 <button type="button" onclick="handleRepairedImageDelete(event)"  value="<%= part._id %>"  class="delete-btn btn btn-danger">Delete</button>
               </div>
             
                <% }) %>
              </div>
              <div id="repaired-parts-container" class="d-flex flex-column gap-2 mt-3">
                 <div class="d-flex gap-3 align-items-center">
                    <input type="file" name="repairedPartImages[]" class="form-control w-50">
                    <input type="text" name="repairedPartNames[]" placeholder="Enter Part Name" class="form-control w-50">
                  </div>
              </div>
              
              <button type="button" id="addRepairedPartBtn" class="btn btn-dark py-2 mt-2 d-flex align-items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                  <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                </svg>
                <h6 class="m-0">Add Another Repaired Part</h6>
              </button>
            </div>
            <input type="hidden" id="arrayOfRepairedIds" name="deletedRepairedIds">
          </div>
        
          <!-- Submit button -->
          <div class="row mb-4">
            <div class="col-md-9 offset-md-3">
              <button type="submit" class="btn btn-success justify-content-center d-flex align-items-center gap-3 px-3 py-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                  <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41m-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9"/>
                  <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5 5 0 0 0 8 3M3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9z"/>
                </svg>
                <h6 class="m-0">UPDATE VEHICLE</h6>
              </button>
            </div>
          </div>
        
        </form>
        





      </div>


        
        
       
      </div>
    
    </div>


    <script>
   const stateCapitals = [
  "Amaravati",      // Andhra Pradesh
  "Itanagar",       // Arunachal Pradesh
  "Dispur",         // Assam
  "Patna",          // Bihar
  "Raipur",         // Chhattisgarh
  "Panaji",         // Goa
  "Gandhinagar",    // Gujarat
  "Chandigarh",     // Haryana
  "Shimla",         // Himachal Pradesh
  "Ranchi",         // Jharkhand
  "Bengaluru",      // Karnataka
  "Thiruvananthapuram", // Kerala
  "Bhopal",         // Madhya Pradesh
  "Mumbai",         // Maharashtra
  "Imphal",         // Manipur
  "Shillong",       // Meghalaya
  "Aizawl",         // Mizoram
  "Kohima",         // Nagaland
  "Bhubaneswar",    // Odisha
  "Chandigarh",     // Punjab
  "Jaipur",         // Rajasthan
  "Gangtok",        // Sikkim
  "Chennai",        // Tamil Nadu
  "Hyderabad",      // Telangana
  "Agartala",       // Tripura
  "Lucknow",        // Uttar Pradesh
  "Dehradun",       // Uttarakhand
  "Kolkata",        // West Bengal
  "Srinagar",       // Jammu and Kashmir (Summer Capital)
  "New Delhi"       // National Capital Territory of Delhi
];


const carCitySelect = document.getElementById('carCity');

// Loop through the array and create option elements
stateCapitals.forEach(state => {
  const option = document.createElement('option');
  option.value = state;
  option.text = state;
  carCitySelect.appendChild(option);
});

document.getElementById('addImperfectPartBtn').addEventListener('click', function() {
  addPartRow('imperfect-parts-container', 'imperfectPartImages[]', 'imperfectPartNames[]');
});

document.getElementById('addRepairedPartBtn').addEventListener('click', function() {
  addPartRow('repaired-parts-container', 'repairedPartImages[]', 'repairedPartNames[]');
});

// Reusable function to add a new part row
function addPartRow(containerId, imageName, nameName) {
  const container = document.getElementById(containerId);

  // Create a new row for image and part name
  const newPartRow = document.createElement('div');
  newPartRow.classList.add('d-flex', 'gap-3', 'align-items-center');

  // Create new input for image
  const newImageInput = document.createElement('input');
  newImageInput.type = 'file';
  newImageInput.name = imageName;
  newImageInput.classList.add('form-control', 'w-25');

  // Create new input for part name
  const newNameInput = document.createElement('input');
  newNameInput.type = 'text';
  newNameInput.name = nameName;
  newNameInput.placeholder = 'Enter Part Name';
  newNameInput.classList.add('form-control', 'w-50');

  // Append inputs to the new row
  newPartRow.appendChild(newImageInput);
  newPartRow.appendChild(newNameInput);

  // Add the new row to the container
  container.appendChild(newPartRow);
}

// Define the arrays outside the function to persist between clicks
const allDeletedImperfectionsId = [];
const allDeletedRepairedId = [];

// Function to handle imperfections image delete
function handleImperfectionsImageDelete(event) {
  const deletebtn = event.currentTarget;
  const choosedImperfectionsId = deletebtn.value;

  // Push the clicked imperfectionsId to the array
  allDeletedImperfectionsId.push(choosedImperfectionsId);

  // Hide the corresponding div (image) by adding the 'd-none' class
  deletebtn.offsetParent.classList.add("d-none");

  // Update the hidden input value dynamically
  updateHiddenInputs();
}

// Function to handle repaired image delete
function handleRepairedImageDelete(event) {
  const deletebtn = event.currentTarget;
  const choosedRepairedId = deletebtn.value;

  // Push the clicked repairedId to the array
  allDeletedRepairedId.push(choosedRepairedId);

  // Hide the corresponding div (image) by adding the 'd-none' class
  deletebtn.offsetParent.classList.add("d-none");

  // Update the hidden input value dynamically
  updateHiddenInputs();
}

// Function to update hidden input values dynamically
function updateHiddenInputs() {
  const arrayOfImperfectionIds = document.querySelector("#arrayOfImperfectionIds");
  const arrayOfRepairedIds = document.querySelector("#arrayOfRepairedIds");

  // Convert the arrays to JSON strings before assigning them to input values
  arrayOfImperfectionIds.value = JSON.stringify(allDeletedImperfectionsId);
  arrayOfRepairedIds.value = JSON.stringify(allDeletedRepairedId);

  // For debugging purposes
  console.log("Imperfections:", arrayOfImperfectionIds.value);
  console.log("Repaired Parts:", arrayOfRepairedIds.value);
}


    </script>
    
</body>
</html>



